## Process vs Thread

> **프로세스** : 프로그램을 메모리 상에서 실행중인 작업
> 
> 
> **스레드** : 프로세스 내 실행되는 여러 흐름 단위
> 

### 프로세스(Process)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d1041837-51e2-450d-bbda-09e2e6e68a41/Untitled.png)

**의미**

- 컴퓨터에서 연속적으로 실행되고 있는 컴퓨터 프로그램
- 운영체제로부터 시스템 자원을 할당받는 작업의 단위
    - 할당받는 시스템 자원  : CPU 시간, 주소공간, code, data, stack 등의 구조로 되어있는 독립된 메모리 영역

**특징**

- 프로세스는 최소 1개의 스레드 가지고 있음
- 프로세스는 각각 독립된 메모리 영역 할당 받음
- 각 프로세스는 별도의 주소 공간에서 실행, 다른 프로세스의 변수나 자료구조에 접근  x
- 다른 프로세스 자원에 접근하려면 프로세스 간  통신(IPC) 필요

**구성**

![스크린샷 2023-05-31 오후 8.15.36.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ea40c31a-79dd-4922-a146-eb36124e24b8/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-05-31_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_8.15.36.png)

- Code : 프로그램 함수들의 코드가 기계어 형태로 저장
- Data : 전역변수나 각종 데이터들이 모여있음
    - .data : 전역 변수 , static 변수 등 프로그램이 사용하는 데이터 저장
    - .BSS : 초기값 없는 전역변수, static 변수
    - .rodata : const 같은 상수 키워드 선언된 변수나 문자열 상수
- Stack : 지역 변수와 같은 호출한 함수가 종료되면 되돌아올 임시적인 자료 저장하는 공간
    - 함수 호출과 함께 할당되며, 함수 호출이 완료되면 소멸
- Heap
    - 생성자, 인스턴스와 같은 동적으로 할당되는 데이터들을 위해 존재
    - 사용자에 의해 메모리 공간이 동적으로 할당되고 해제

### 스레드(Thread)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1aef8686-8167-4a6c-b5cf-aaeb0c2c6703/Untitled.png)

**의미**

- 프로세스 내 실행되는 여러 흐름 단위
- 프로세스의 특정한 수행 경로
- 프로세스가 할당받은 자원을 이용하는 실행 단위

**특징**

- 스레드는 프로세스 내에서 stack만 따로 할당받고, code, data, heap은 공유
- 프로세스 내 주소 공간이나 자원등을 같은 프로세스 내에서 쓰레드끼리 공유하면서 실행

**구성**

- stack
- Memory for registers context ( program counter, registers 등)
    - thread control block

### 스택을 스레드마다 독립적으로 할당하는 이유

- 스택은 함수 호출 시 전달되는 인자, 되돌아갈 주소값 및 함수 내에서 선언하는 변수 등을 저장하기 위해 사용되는 메모리 공간
- 독립적인 스택을 가졌다는 것은 독립적인 함수 호출이 가능하다는 것이고 이는 독립적인 실행 흐름이 추가되는 것이다.
- 즉, stack을 가짐으로써 스레드는 독립적인 실행 흐름을 가질 수 있게 되는 것
    - 스레드의 정의에 따라 독립적인 실행 흐름을 추가하기 위한 최소 조건으로 독립된 스택을 할당한다.

## Multi Process VS Multi Thread

![스크린샷 2023-05-31 오후 8.24.35.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b28a71f4-fbfb-4899-ba3c-c888d30da6ff/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-05-31_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_8.24.35.png)

### 멀티 프로세스

- 하나의 프로그램을 여러개의 프로세스로 구성하여 프로세스가 병렬적으로 작업을 수행
- 부모 프로세스가 여러 개의 자식 프로세스 생성
    - 각 고유의 PID로 통신 가능
- 장점 : 프로그램 안전성
    - 멀티 프로세스는 각 프로세스가 독립적인 메모리 공간을 가지므로, 한 프로세스가 비정상적으로 종료되어도 다른 프로세스에 영향을 주지 않는다. 그래서 프로그램 전체의 안전성을 확보할 수 있다는 장점이 있다.
- 단점
    1. context switching overhead
    - 프로세스를 컨텍스트 스위칭 하면, CPU는 다음 프로세스의 정보를 불러오기 위해 메모리를 검색하고, CPU 캐시 메모리를 초기화하며, 프로세스 상태를 저장하고, 불러올 데이터를 준비해야 하기 때문에, 이로 인한 빈번한 Context Switching 작업으로 인해 비용 오버헤드가 발생할 수 있게 된다.
    2. 자원 공유의 비효율성
    - IPC 오버헤드

### 멀티 스레드

- 하나의 응용 프로그램에서 여러 스레드를 구성해 각 스레드가 하나의 작업을 처리하는 것
- ex) 웹서버 : 사용자가 서버 데이터베이스에 자료를 요청하는 동안 브라우저의 다른 기능을 이용 가능
- 장점
    1. 프로세스보다 가벼움
    2. 자원의 효율성
    - 공유 메모리에 대해 스레드 간 자원 공유 가능 >> IPC 사용 x
    3. ****Context Switching 비용 감소****
    - 프로세스 컨텍스트 스위칭 비용은 스위칭할 때마다 CPU 캐시에 있는 내용을 모두 초기화하고, 새로운 프로세스 정보를 CPU 캐시에 적재해야 하므로 높은 비용이 든다. 반면, 스레드 컨텍스트 스위칭 비용은 스위칭할 때 스레드 간에 공유하는 자원을 제외한 스레드 정보(stack, register)만을 교체하면 되므로 프로세스 컨텍스트 스위칭 비용보다 상대적으로 낮은 것이다.
- 단점
    - 안정성 : 하나의 스레드가 데이터 공간 망가뜨리면, 모든 스레드가 작동 불능 상태 (공유 메모리를 갖기 때문)

### 예상 질문

1. Process와 Thread의 차이를 설명해 주세요.
    - 한 프로세스에는 기본적으로 하나의 쓰레드가 존재한다. 프로세스는 **code, data** 메모리 공간이 존재하는데, 이는 여러 쓰레드가 공유한다. 이외에도 프로세스의 자원인 file, I/O 등은 여러 쓰레드가 공유하지만, 각 쓰레드가 고유하게 가지고 있는 것은 PC(Program Counter), SP(Stack Pointer), registers, **stack** 등이 있다.
2. Multi Process와 Multi Thread 차이를 설명해 주세요.
  - 멀티 프로세스는 하나의 프로그램을 여러개의 프로세스로 구성하여 프로세스가 병렬적으로 작업을 수행하는 것으로 각 프로세스가 독립적인 메모리 공간을 가지므로, 한 프로세스가 비정상적으로 종료되어도 다른 프로세스에 영향을 주지 않아 프로그램의 안정성을 확보할 수 있다. 단점으로는 ontext switching overhead와 IPC 오버헤드가 있다.
  - 멀티 스레드는 하나의 응용 프로그램에서 여러 스레드를 구성해 각 스레드가 하나의 작업을 처리하는 것으로 프로세스보다 가볍고 공유 메모리에 대해 스레드 간 자원 공유 가능해 자원의 효율성이 있다. 또, 프로세스 컨텍스트 스위칭보다 비용이 낮다. 하지만 공유메모리를 가져 하나의 스레드가 데이터 공간 망가뜨리면, 모든 스레드가 작동 불능 상태가 되어 프로그램의 안정성이 낮다.
