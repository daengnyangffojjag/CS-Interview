### 로드밸런싱

<aside>
💡 트래픽이 늘어 날 때 대처방법?

</aside>

### 1. Scale-up

기존의 서버를 보다 높은 사양으로 업그레이드

- 성능이나 용량 증강을 목적
- 디스크 추가 혹은 CPU나 메모리를 업그레이드
- **수직 스케일링**

### 2. Scale-out

비슷한 사양의 서버를 추가해 서버의 부하를 분담

- 데이터 용량의 증가나 성능 향상을 목적
- 클라우드 서비스에선 모니터링을 통한 Auto Scaling 기능이 있음
- **수평 스케일링**

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5ef89dad-e8c2-4673-82fe-a19dfbc65414/Untitled.png)

<aside>
💡 트래릭을 분산시켜주는 Scale-out 방식엔 로드 밸런싱이 필요하다

</aside>

### 로드밸런싱

> 서버가 처리해야 할 요청(Load)을 **여러 대의 서버로 나누어**(Balancing) 처리하는 것
> 
- 한 대의 서버로 부하가 집중되지 않도록 트래픽을 관리
- 각각의 서버가 최적의 퍼포먼스를 보일 수 있도록 함

### 로드밸런서

로드밸런싱 기술을 제공하는 서비스 또는 장치

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/25472dea-806f-4823-8198-bf0e5e4e5f6d/Untitled.png)

- 클라이언트와 네트워크 트래픽이 집중되는 서버 상단 네트웨크에 위치
- 서버 한대에 집중되지 않게 트래픽을 관리

### 로드밸런서의 종류

OSI 계층을 기준으로 부하를 어떻게 분산할지 종류를 나눈다

| L2 | Data link 계층을 사용, Mac주소 기반 부하 분산 |  |
| --- | --- | --- |
| L3 | Network 계층을 사용, IP주소 기반 부하 분산 |  |
| L4 | Transport 계층을 사용, Port 기반 부하 분산 | TCP, UDP 프로토콜 사용 |
| L7 | Application 계층을 사용, 요청(URL) 기반 부하 분산 | HTTP, HTTPS 프로토콜 사용 |
- 상위 계층일 수록 더 정교하고 섬세한 로드밸런싱이 가능
- 상위 계층은 하위 계층의 데이터를 모두 가짐
- 상위 계층일수록 비용이 비싸지만 현재는 가격차이가 줄어들어 보통 L4 또는 L7을 주로 사용

### L4 vs L7

|  | L4 | L7 |
| --- | --- | --- |
| 네트워크 계층 | 전송계층(Transport Layer) | 응용계층(Application Layer) |
| 특징 | TCP, UDP(전송계층) 포트 정보를 기반 | TCP, UDP + HTTP의 헤더, 쿠키 등 사용자의 요청을 기반  |
| 장점 | 1. 데이터를 보지 않고 패킷 레벨에서 로드(Load)를 분산하기 떄문에 속도와 효율이 좋음                                           | 1. 패킷의 내용을 확인해서 그 내용에 따라 트래픽을 특정 서버에 보낼 수 있음 |
|  | 2. 전송 계층에서 동작하며, 단순하고 성능이 높음 | 2. 특정 요청, 특정 URL은 특정 서버로 보내는 섬세한 트래픽 관리가 가능 |
|  |  | 3. 웹 어플리케이션, API 서버 , MSA 등 다양한 환경에서 사용 가능 |
|  |  | 4. 캐싱, 세션관리 등의 기능을 제공 |
| 단점 | 1. 전송 계층의 정보만을 고려하기 때문에 기능이 제한됨 | 1. 패킷의 정보를 분석해야 하기 때문에 처리 속도가 상대적으로 느리고 성능 부하가 큼 |
|  | 2. IP주소나 포트 번호를 기반으로 트래픽을 분산시키기 때문에 서버의 상태나 요청에 따라 분산하기 어려움 | 2. 설정의 복잡함 + 리소스가 많이 필요함 |
|  | 3. 서버의 성능 차이나 트래픽 패턴에 따른 다양한 상황에 대한 대처에 어려움 | 3. 패킷의 내용을 복호화(HTTPS)해야 되기 때문에 더 많은 리소스 필요 |

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3dc1d29e-090a-4153-9085-452678c5ae91/Untitled.png)

### 로드밸런싱 방식(알고리즘)

1. **라운드로빈 방식(Round Robin Method)**
- 각 서버에 부하를 **균등하게** 분산
- 로드밸런서가 **순서대로** 각 서버에 분배
- 각 서버는 **동일한** 부하를 처리
1. **가중 라운드로빈 방식(Weighted Round Robin Method)**
- 각 서버에 **부여된 가중치**에 따라 트래픽을 분산
- 가중치가 높은 서버에 더 많은 트래픽을 할당
- 서버의 **성능에 따라** 트래픽을 처리
1. **최소 연결 방식(Least Connection Method)**
- 서버 중 현재 클라이언트와 연결된 **커넥션이 가장 적은 서버**에 트래픽을 보냄
- 서버에 분배된 트래픽들이 일정하지 않은 경우에 적합
1. **IP 해시 방식(IP Hash Method)**
- 클라이언트의 IP 주소를 **해시 함수**에 넣어 서버를 선택
- 동일한 클라이언트는 **항상 같은 서버**로 연결
- 세션 유지 등의 요구사항에 적합

### 예상질문

1. 로드밸런싱의 개념과 목적에 대해 설명해주세요

로드 밸런싱은 트래픽을 여러 서버로 분산시켜 부하를 분담하는 기술이고 그로 인해 트래픽을 한 서버가 부담하지 않게 하고 각각의 서버의 성능을 보장하고 향상시킬 수 있습니다

1. 로드 밸런서의 종류(L4, L7)에 대해서 설명해주세요

로드 밸런서의 종류에는 L4 로드 밸런서와 L7 로드 밸런서가 있습니다. L4 로드 밸런서는 전송 계층에서 작동하며 IP 주소와 포트 번호에 따라 트래픽을 분산시킵니다. L7 로드 밸런서는 응용 계층에서 작동하며 HTTP 헤더, URL, 쿠키 등과 같은 정보를 활용하여 트래픽을 분산시킵니다.

1. L4 로드밸런서와 L7 로드밸런서를 비교해주세요

L4 로드밸런서는 전송 계층에서 작동하며 IP주소와 포트번호에 따라 트래픽을 분산시킵니다. 패킷 레벨에서 동작하기 때문에 속도와 효율면에서 좋으나 기능적인 면이나 다양한 상황에 불리합니다. L7 로드밸런서는 응용 계층에서 작동하며 HTTP 헤더나, URL, 쿠키와 같은 패킷의 내용을 활용하기 떄문에 클라이언트의 요청을 기반으로 좀더 다양하고 섬세한 트래픽 관리가 가능합니다

1. 로드 밸런싱 알고리즘에는 어떤게 있는지 설명해주세요 ( 1~2개)

로드 밸런싱 알고리즘에는 라운드 로빈, 가중 라운드로빈, 최소 연결, IP 해시 방식이 있습니다. 라운드 로빈 방식은 순서대로 서버에 요청을 분배하는 방식이며, 각 서버는 동일한 부하를 처리합니다. 가중 라운드로빈 방식은 서버에 가중치를 부여하여 각각의 서버에 부하를 조절해 서버의 성능에 따라 트래픽 처리가 가능합니다. 최소 연결 방식은 현재 커넥션 수가 가장 적은 서버에 요청을 보내는 방식이고 서버에 분배된 트래픽들이 일정하지 않을 때 적합합니다. IP 해시 방식은 클라이언트 IP 주소를 해시화하여 특정 서버에 요청을 전달하고 세션 유지 등의 요구사항에 적합합니다. 각 알고리즘은 특정 상황, 성능, 트래픽 패턴 등을 고려하여 선택해야 합니다.

[[Network/네트워크] 로드밸런싱 (Load Balancing) - 정의, 종류, 알고리즘](https://velog.io/@yanghl98/OS운영체제-로드밸런싱-Load-Balancing-정의-종류-알고리즘)

[로드 밸런싱에 대해 알아보자!](https://tecoble.techcourse.co.kr/post/2021-11-07-load-balancing/)

[로드밸런서의 종류와 동작방식](https://deveric.tistory.com/91)
